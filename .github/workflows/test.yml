name: test

on: [push]

jobs:
  test:
    name: test-${{ github.run_number }}
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: Get credentials
      uses: leanix/secrets-action@master
      with:
        secret-store-credentials: ${{ secrets.INJECTED_SECRET_STORE_CREDENTIALS }}
    - uses: webfactory/ssh-agent@v0.2.0
      with:
        ssh-private-key: ${{ env.CI_GITHUB_SSH_PRIVATE_KEY }}
    - name: use-action
      id: build-image
      uses: ./
      with:
        path: test/
    - run: echo ${{ steps.build-image.outputs.tag }} ${{ steps.build-image.outputs.latest_tag }}
    - name: use-action-in-output-only-mode
      id: image-tags
      uses: ./
      with:
        only-output-tags: true
    - run: echo ${{ steps.image-tags.outputs.tag }} ${{ steps.image-tags.outputs.latest_tag }}
    - run: '[[ "${{ steps.build-image.outputs.tag }}" == "${{ steps.image-tags.outputs.tag }}" ]]'
